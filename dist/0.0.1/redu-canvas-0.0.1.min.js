(function(j,g,i,n,Q,R){function z(a,b){var c=typeof a[b];return"function"==c||!!("object"==c&&a[b])||"unknown"==c}function S(){try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");E=Array.prototype.slice.call(a.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1);K=9<parseInt(E[0],10)&&0<parseInt(E[1],10);return!0}catch(b){return!1}}function F(){if(!w){w=!0;for(var a=0;a<G.length;a++)G[a]();G.length=0}}function x(a,b){w?a.call(b):G.push(function(){a.call(b)})}function o(a){var b=a.toLowerCase().match(H),
a=b[2],c=b[3],b=b[4]||"";if("http:"==a&&":80"==b||"https:"==a&&":443"==b)b="";return a+"//"+c+b}function C(a){a=a.replace(ba,"$1/");if(!a.match(/^(http||https):\/\//)){var b="/"===a.substring(0,1)?"":i.pathname;"/"!==b.substring(b.length-1)&&(b=b.substring(0,b.lastIndexOf("/")+1));a=i.protocol+"//"+i.host+b+a}for(;T.test(a);)a=a.replace(T,"");return a}function A(a,b){var c="",d=a.indexOf("#");-1!==d&&(c=a.substring(d),a=a.substring(0,d));var d=[],f;for(f in b)b.hasOwnProperty(f)&&d.push(f+"="+R(b[f]));
return a+(U?"#":-1==a.indexOf("?")?"?":"&")+d.join("&")+c}function y(a){return"undefined"===typeof a}function p(a,b,c){var d,f;for(f in b)b.hasOwnProperty(f)&&(f in a?(d=b[f],"object"===typeof d?p(a[f],d,c):c||(a[f]=b[f])):a[f]=b[f]);return a}function v(a){if(y(L)){var b=g.body.appendChild(g.createElement("form")),c=b.appendChild(g.createElement("input"));c.name=s+"TEST"+V;L=c!==b.elements[c.name];g.body.removeChild(b)}L?b=g.createElement('<iframe name="'+a.props.name+'"/>'):(b=g.createElement("IFRAME"),
b.name=a.props.name);b.id=b.name=a.props.name;delete a.props.name;a.onLoad&&t(b,"load",a.onLoad);"string"==typeof a.container&&(a.container=g.getElementById(a.container));a.container||(p(b.style,{position:"absolute",top:"-2000px"}),a.container=g.body);c=a.props.src;delete a.props.src;p(b,a.props);b.border=b.frameBorder=0;b.allowTransparency=!0;a.container.appendChild(b);b.src=c;a.props.src=c;return b}function W(a){var b=a.protocol,c;a.isHost=a.isHost||y(q.xdm_p);U=a.hash||!1;a.props||(a.props={});
if(a.isHost)a.remote=C(a.remote),a.channel=a.channel||"default"+V++,a.secret=Math.random().toString(16).substring(2),y(b)&&(o(i.href)==o(a.remote)?b="4":z(j,"postMessage")||z(g,"postMessage")?b="1":a.swf&&z(j,"ActiveXObject")&&S()?b="6":"Gecko"===navigator.product&&"frameElement"in j&&-1==navigator.userAgent.indexOf("WebKit")?b="5":a.remoteHelper?(a.remoteHelper=C(a.remoteHelper),b="2"):b="0");else{a.channel=q.xdm_c;a.secret=q.xdm_s;a.remote=q.xdm_e;var b=q.xdm_p,d;if(d=a.acl){a:{d=a.acl;var f=a.remote;
"string"==typeof d&&(d=[d]);for(var e,l=d.length;l--;)if(e=d[l],e=RegExp("^"==e.substr(0,1)?e:"^"+e.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),e.test(f)){d=!0;break a}d=!1}d=!d}if(d)throw Error("Access denied for "+a.remote);}a.protocol=b;switch(b){case "0":p(a,{interval:100,delay:2E3,useResize:!0,useParent:!1,usePolling:!1},!0);if(a.isHost){if(!a.local){b=i.protocol+"//"+i.host;c=g.body.getElementsByTagName("img");for(f=c.length;f--;)if(d=c[f],d.src.substring(0,b.length)===b){a.local=d.src;break}a.local||
(a.local=j)}b={xdm_c:a.channel,xdm_p:0};a.local===j?(a.usePolling=!0,a.useParent=!0,a.local=i.protocol+"//"+i.host+i.pathname+i.search,b.xdm_e=a.local,b.xdm_pa=1):b.xdm_e=C(a.local);a.container&&(a.useResize=!1,b.xdm_po=1);a.remote=A(a.remote,b)}else p(a,{channel:q.xdm_c,remote:q.xdm_e,useParent:!y(q.xdm_pa),usePolling:!y(q.xdm_po),useResize:a.useParent?!1:a.useResize});c=[new h.stack.HashTransport(a),new h.stack.ReliableBehavior({}),new h.stack.QueueBehavior({encode:!0,maxLength:4E3-a.remote.length}),
new h.stack.VerifyBehavior({initiate:a.isHost})];break;case "1":c=[new h.stack.PostMessageTransport(a)];break;case "2":c=[new h.stack.NameTransport(a),new h.stack.QueueBehavior,new h.stack.VerifyBehavior({initiate:a.isHost})];break;case "3":c=[new h.stack.NixTransport(a)];break;case "4":c=[new h.stack.SameOriginTransport(a)];break;case "5":c=[new h.stack.FrameElementTransport(a)];break;case "6":E||S(),c=[new h.stack.FlashTransport(a)]}c.push(new h.stack.QueueBehavior({lazy:a.lazy,remove:!0}));return c}
function X(a){for(var b,c={incoming:function(a,b){this.up.incoming(a,b)},outgoing:function(a,b){this.down.outgoing(a,b)},callback:function(a){this.up.callback(a)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},d=0,f=a.length;d<f;d++)if(b=a[d],p(b,c,!0),0!==d&&(b.down=a[d-1]),d!==f-1)b.up=a[d+1];return b}var I=this,V=Math.floor(1E4*Math.random()),M=Function.prototype,H=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,T=/[\-\w]+\/\.\.\//,ba=/([^:])\/\//g,D="",h={},ca=j.easyXDM,s="easyXDM_",
L,U=!1,E,K,t,B;if(z(j,"addEventListener"))t=function(a,b,c){a.addEventListener(b,c,!1)},B=function(a,b,c){a.removeEventListener(b,c,!1)};else if(z(j,"attachEvent"))t=function(a,b,c){a.attachEvent("on"+b,c)},B=function(a,b,c){a.detachEvent("on"+b,c)};else throw Error("Browser not supported");var w=!1,G=[],u;"readyState"in g?(u=g.readyState,w="complete"==u||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==u||"interactive"==u)):w=!!g.body;if(!w){if(z(j,"addEventListener"))t(g,"DOMContentLoaded",
F);else if(t(g,"readystatechange",function(){g.readyState=="complete"&&F()}),g.documentElement.doScroll&&j===top){var Y=function(){if(!w){try{g.documentElement.doScroll("left")}catch(a){n(Y,1);return}F()}};Y()}t(j,"load",F)}var q;u=/xdm_e=/.test(i.search)?i.search:i.hash;u=u.substring(1).split("&");for(var Z={},N,$=u.length;$--;)N=u[$].split("="),Z[N[0]]=Q(N[1]);q=Z;var O=function(){var a={},b={a:[1,2,3]};if(typeof JSON!="undefined"&&typeof JSON.stringify==="function"&&JSON.stringify(b).replace(/\s/g,
"")==='{"a":[1,2,3]}')return JSON;if(Object.toJSON&&Object.toJSON(b).replace(/\s/g,"")==='{"a":[1,2,3]}')a.stringify=Object.toJSON;if(typeof String.prototype.evalJSON==="function"){b='{"a":[1,2,3]}'.evalJSON();if(b.a&&b.a.length===3&&b.a[2]===3)a.parse=function(a){return a.evalJSON()}}if(a.stringify&&a.parse){O=function(){return a};return a}return null};p(h,{version:"2.4.15.118",query:q,stack:{},apply:p,getJSONObject:O,whenReady:x,noConflict:function(a){j.easyXDM=ca;(D=a)&&(s="easyXDM_"+D.replace(".",
"_")+"_");return h}});h.DomHelper={on:t,un:B,requiresJSON:function(a){typeof j.JSON=="object"&&j.JSON||g.write('<script type="text/javascript" src="'+a+'"><\/script>')}};var P={};h.Fn={set:function(a,b){P[a]=b},get:function(a,b){var c=P[a];b&&delete P[a];return c}};h.Socket=function(a){var b=X(W(a).concat([{incoming:function(b,c){a.onMessage(b,c)},callback:function(b){if(a.onReady)a.onReady(b)}}])),c=o(a.remote);this.origin=o(a.remote);this.destroy=function(){b.destroy()};this.postMessage=function(a){b.outgoing(a,
c)};b.init()};h.Rpc=function(a,b){if(b.local)for(var c in b.local)if(b.local.hasOwnProperty(c)){var d=b.local[c];typeof d==="function"&&(b.local[c]={method:d})}var f=X(W(a).concat([new h.stack.RpcBehavior(this,b),{callback:function(b){if(a.onReady)a.onReady(b)}}]));this.origin=o(a.remote);this.destroy=function(){f.destroy()};f.init()};h.stack.SameOriginTransport=function(a){var b,c,d,f;return b={outgoing:function(a,b,c){d(a);c&&c()},destroy:function(){if(c){c.parentNode.removeChild(c);c=null}},onDOMReady:function(){f=
o(a.remote);if(a.isHost){p(a.props,{src:A(a.remote,{xdm_e:i.protocol+"//"+i.host+i.pathname,xdm_c:a.channel,xdm_p:4}),name:s+a.channel+"_provider"});c=v(a);h.Fn.set(a.channel,function(a){d=a;n(function(){b.up.callback(true)},0);return function(a){b.up.incoming(a,f)}})}else{var e=parent;if(D!=="")for(var l=0,m=D.split(".");l<m.length;l++)e=e[m[l]];d=e.easyXDM.Fn.get(a.channel,true)(function(a){b.up.incoming(a,f)});n(function(){b.up.callback(true)},0)}},init:function(){x(b.onDOMReady,b)}}};h.stack.FlashTransport=
function(a){function b(a){n(function(){c.up.incoming(a,f)},0)}var c,d,f,e,l;return c={outgoing:function(b,c,d){e.postMessage(a.channel,b.toString());d&&d()},destroy:function(){try{e.destroyChannel(a.channel)}catch(b){}e=null;if(d){d.parentNode.removeChild(d);d=null}},onDOMReady:function(){f=a.remote;h.Fn.set("flash_"+a.channel+"_init",function(){n(function(){c.up.callback(true)})});h.Fn.set("flash_"+a.channel+"_onMessage",b);a.swf=C(a.swf);var m=a.swf.match(H)[3],k=function(){h.stack.FlashTransport[m].init=
true;e=h.stack.FlashTransport[m].swf;e.createChannel(a.channel,a.secret,o(a.remote),a.isHost);if(a.isHost){K&&a.swfNoThrottle&&p(a.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"});p(a.props,{src:A(a.remote,{xdm_e:o(i.href),xdm_c:a.channel,xdm_p:6,xdm_s:a.secret}),name:s+a.channel+"_provider"});d=v(a)}};if(h.stack.FlashTransport[m]&&h.stack.FlashTransport[m].init)k();else if(h.stack.FlashTransport[m])h.stack.FlashTransport[m].queue.push(k);else{h.stack.FlashTransport[m]={queue:[k]};
var k=a.swf+"?host="+a.isHost,j="easyXDM_swf_"+Math.floor(Math.random()*1E4);h.Fn.set("flash_loaded"+m.replace(/[\-.]/g,"_"),function(){h.stack.FlashTransport[m].swf=e=l.firstChild;for(var a=h.stack.FlashTransport[m].queue,b=0;b<a.length;b++)a[b]();a.length=0});if(a.swfContainer)l=typeof a.swfContainer=="string"?g.getElementById(a.swfContainer):a.swfContainer;else{l=g.createElement("div");p(l.style,K&&a.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",
position:"absolute",overflow:"hidden",right:0,top:0});g.body.appendChild(l)}var r="callback=flash_loaded"+m.replace(/[\-.]/g,"_")+"&proto="+I.location.protocol+"&domain="+I.location.href.match(H)[3]+"&port="+(I.location.href.match(H)[4]||"")+"&ns="+D;l.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+j+"' data='"+k+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+k+"'></param><param name='flashvars' value='"+
r+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+r+"' allowScriptAccess='always' wmode='transparent' src='"+k+"' height='1' width='1'></embed></object>"}},init:function(){x(c.onDOMReady,c)}}};h.stack.PostMessageTransport=function(a){function b(b){var d;if(b.origin)d=o(b.origin);else if(b.uri)d=o(b.uri);else if(b.domain)d=i.protocol+"//"+b.domain;else throw"Unable to retrieve the origin of the event";d==e&&b.data.substring(0,a.channel.length+1)==a.channel+" "&&c.up.incoming(b.data.substring(a.channel.length+
1),d)}var c,d,f,e;return c={outgoing:function(b,c,d){f.postMessage(a.channel+" "+b,c||e);d&&d()},destroy:function(){B(j,"message",b);if(d){f=null;d.parentNode.removeChild(d);d=null}},onDOMReady:function(){e=o(a.remote);if(a.isHost){var h=function(e){if(e.data==a.channel+"-ready"){f="postMessage"in d.contentWindow?d.contentWindow:d.contentWindow.document;B(j,"message",h);t(j,"message",b);n(function(){c.up.callback(true)},0)}};t(j,"message",h);p(a.props,{src:A(a.remote,{xdm_e:o(i.href),xdm_c:a.channel,
xdm_p:1}),name:s+a.channel+"_provider"});d=v(a)}else{t(j,"message",b);f="postMessage"in j.parent?j.parent:j.parent.document;f.postMessage(a.channel+"-ready",e);n(function(){c.up.callback(true)},0)}},init:function(){x(c.onDOMReady,c)}}};h.stack.FrameElementTransport=function(a){var b,c,d,f;return b={outgoing:function(a,b,c){d.call(this,a);c&&c()},destroy:function(){if(c){c.parentNode.removeChild(c);c=null}},onDOMReady:function(){f=o(a.remote);if(a.isHost){p(a.props,{src:A(a.remote,{xdm_e:o(i.href),
xdm_c:a.channel,xdm_p:5}),name:s+a.channel+"_provider"});c=v(a);c.fn=function(a){delete c.fn;d=a;n(function(){b.up.callback(true)},0);return function(a){b.up.incoming(a,f)}}}else{if(g.referrer&&o(g.referrer)!=q.xdm_e)j.top.location=q.xdm_e;d=j.frameElement.fn(function(a){b.up.incoming(a,f)});b.up.callback(true)}},init:function(){x(b.onDOMReady,b)}}};h.stack.NameTransport=function(a){function b(b){m.contentWindow.sendMessage(b,a.remoteHelper+(g?"#_3":"#_2")+a.channel)}function c(){if(g)(++j===2||!g)&&
e.up.callback(true);else{b("ready");e.up.callback(true)}}function d(a){e.up.incoming(a,i)}function f(){r&&n(function(){r(true)},0)}var e,g,m,k,j,r,i,J;return e={outgoing:function(a,c,d){r=d;b(a)},destroy:function(){m.parentNode.removeChild(m);m=null;if(g){k.parentNode.removeChild(k);k=null}},onDOMReady:function(){g=a.isHost;j=0;i=o(a.remote);a.local=C(a.local);if(g){h.Fn.set(a.channel,function(b){if(g&&b==="ready"){h.Fn.set(a.channel,d);c()}});J=A(a.remote,{xdm_e:a.local,xdm_c:a.channel,xdm_p:2});
p(a.props,{src:J+"#"+a.channel,name:s+a.channel+"_provider"});k=v(a)}else{a.remoteHelper=a.remote;h.Fn.set(a.channel,d)}m=v({props:{src:a.local+"#_4"+a.channel},onLoad:function ea(){var b=m||this;B(b,"load",ea);h.Fn.set(a.channel+"_load",f);(function ga(){typeof b.contentWindow.sendMessage=="function"?c():n(ga,50)})()}})},init:function(){x(e.onDOMReady,e)}}};h.stack.HashTransport=function(a){function b(){if(k){var a=k.location.href,b="",d=a.indexOf("#");d!=-1&&(b=a.substring(d));if(b&&b!=g){g=b;c.up.incoming(g.substring(g.indexOf("_")+
1),aa)}}}var c,d,f,e,g,h,k,i,r,aa;return c={outgoing:function(b){if(i){b=a.remote+"#"+h++ +"_"+b;(d||!r?i.contentWindow:i).location=b}},destroy:function(){j.clearInterval(f);(d||!r)&&i.parentNode.removeChild(i);i=null},onDOMReady:function(){d=a.isHost;e=a.interval;g="#"+a.channel;h=0;r=a.useParent;aa=o(a.remote);if(d){a.props={src:a.remote,name:s+a.channel+"_provider"};if(r)a.onLoad=function(){k=j;f=setInterval(b,e);c.up.callback(true)};else{var J=0,da=a.delay/50;(function fa(){if(++J>da)throw Error("Unable to reference listenerwindow");
try{k=i.contentWindow.frames[s+a.channel+"_consumer"]}catch(d){}if(k){f=setInterval(b,e);c.up.callback(true)}else n(fa,50)})()}i=v(a)}else{k=j;f=setInterval(b,e);if(r){i=parent;c.up.callback(true)}else{p(a,{props:{src:a.remote+"#"+a.channel+new Date,name:s+a.channel+"_consumer"},onLoad:function(){c.up.callback(true)}});i=v(a)}}},init:function(){x(c.onDOMReady,c)}}};h.stack.ReliableBehavior=function(){var a,b,c=0,d=0,f="";return a={incoming:function(e,g){var h=e.indexOf("_"),k=e.substring(0,h).split(","),
e=e.substring(h+1);if(k[0]==c){f="";b&&b(true)}if(e.length>0){a.down.outgoing(k[1]+","+c+"_"+f,g);if(d!=k[1]){d=k[1];a.up.incoming(e,g)}}},outgoing:function(e,g,h){f=e;b=h;a.down.outgoing(d+","+ ++c+"_"+e,g)}}};h.stack.QueueBehavior=function(a){function b(){if(a.remove&&d.length===0){var e=c;e.up.down=e.down;e.down.up=e.up;e.up=e.down=null}else if(!f&&!(d.length===0||g)){f=true;var h=d.shift();c.down.outgoing(h.data,h.origin,function(a){f=false;h.callback&&n(function(){h.callback(a)},0);b()})}}var c,
d=[],f=true,e="",g,h=0,k=false,i=false;return c={init:function(){y(a)&&(a={});if(a.maxLength){h=a.maxLength;i=true}a.lazy?k=true:c.down.init()},callback:function(a){f=false;var d=c.up;b();d.callback(a)},incoming:function(b,d){if(i){var f=b.indexOf("_"),h=parseInt(b.substring(0,f),10);e=e+b.substring(f+1);if(h===0){a.encode&&(e=Q(e));c.up.incoming(e,d);e=""}}else c.up.incoming(b,d)},outgoing:function(e,f,g){a.encode&&(e=R(e));var j=[],l;if(i){for(;e.length!==0;){l=e.substring(0,h);e=e.substring(l.length);
j.push(l)}for(;l=j.shift();)d.push({data:j.length+"_"+l,origin:f,callback:j.length===0?g:null})}else d.push({data:e,origin:f,callback:g});k?c.down.init():b()},destroy:function(){g=true;c.down.destroy()}}};h.stack.VerifyBehavior=function(a){function b(){d=Math.random().toString(16).substring(2);c.down.outgoing(d)}var c,d,f;return c={incoming:function(e,h){var g=e.indexOf("_");if(g===-1)if(e===d)c.up.callback(true);else{if(!f){f=e;a.initiate||b();c.down.outgoing(e)}}else e.substring(0,g)===f&&c.up.incoming(e.substring(g+
1),h)},outgoing:function(a,b,f){c.down.outgoing(d+"_"+a,b,f)},callback:function(){a.initiate&&b()}}};h.stack.RpcBehavior=function(a,b){function c(a){a.jsonrpc="2.0";f.down.outgoing(e.stringify(a))}function d(a,b){var d=Array.prototype.slice;return function(){var e=arguments.length,f,i={method:b};if(e>0&&typeof arguments[e-1]==="function"){if(e>1&&typeof arguments[e-2]==="function"){f={success:arguments[e-2],error:arguments[e-1]};i.params=d.call(arguments,0,e-2)}else{f={success:arguments[e-1]};i.params=
d.call(arguments,0,e-1)}h[""+ ++g]=f;i.id=g}else i.params=d.call(arguments,0);if(a.namedParams&&i.params.length===1)i.params=i.params[0];c(i)}}var f,e=b.serializer||O(),g=0,h={};return f={incoming:function(a){a=e.parse(a);if(a.method)if(b.handle)b.handle(a,c);else{var d=a.id,f=b.local[a.method],a=a.params;if(f){var g,i;if(d){g=function(a){g=M;c({id:d,result:a})};i=function(a,b){i=M;var e={id:d,error:{code:-32099,message:a}};if(b)e.error.data=b;c(e)}}else g=i=M;Object.prototype.toString.call(a)!==
"[object Array]"&&(a=[a]);try{var j=f.method.apply(f.scope,a.concat([g,i]));y(j)||g(j)}catch(l){i(l.message)}}else d&&c({id:d,error:{code:-32601,message:"Procedure not found."}})}else{j=h[a.id];a.error?j.error&&j.error(a.error):j.success&&j.success(a.result);delete h[a.id]}},init:function(){if(b.remote)for(var c in b.remote)b.remote.hasOwnProperty(c)&&(a[c]=d(b.remote[c],c));f.down.init()},destroy:function(){for(var c in b.remote)b.remote.hasOwnProperty(c)&&a.hasOwnProperty(c)&&delete a[c];f.down.destroy()}}};
I.easyXDM=h})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);
(function(){window.Redu||(window.Redu={});window.Redu.Canvas=function(j){var g=this;this.config=this.utils.extend({width:720,height:1E3,logger:function(){}},j);this.logger=this.config.logger;if(this.canvasEnabled())this.socket=new easyXDM.Socket({onReady:function(){var i=g.prepareMessage("resize",{width:g.config.width,height:g.config.height});g.logger(i);g.socket.postMessage(i)}})};window.Redu.Canvas.prototype.version="0.1";window.Redu.Canvas.prototype.utils={};window.Redu.Canvas.prototype.utils.extend=
function(j,g){for(var i in g)j[i]=g[i]&&g[i].constructor&&g[i].constructor===Object?extend(j[i]||{},g[i]):g[i];return j};window.Redu.Canvas.prototype.prepareMessage=function(j,g){return JSON.stringify({event:"resize",payload:{width:g.width,height:g.height},version:this.version})};window.Redu.Canvas.prototype.canvasEnabled=function(){return this.parseUri(document.URL).queryKey.xdm_e!=void 0};window.Redu.Canvas.prototype.parseUri=function(j){for(var g=["source","protocol","authority","userInfo","user",
"password","host","port","relative","path","directory","file","query","anchor"],j=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(j),i={},n=14;n--;)i[g[n]]=j[n]||"";i.queryKey={};i[g[12]].replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(g,j,n){j&&(i.queryKey[j]=n)});return i}})();
